<script src="https://cdn.jsdelivr.net/npm/keycloak-js@25.0.6/dist/keycloak.min.js"></script>

<script>
  // Create Keycloak instance
  const keycloak = new Keycloak({
    url: "https://securedev.virtuele.us",
    realm: "virtuele-dev",
    clientId: "web"
  });

  // Optional: expose globally
  window.keycloak = keycloak;

  (async () => {
    try {
      const authenticated = await keycloak.init({
        onLoad: "check-sso",
        pkceMethod: "S256",
        silentCheckSsoRedirectUri:
          location.origin + "/trimbleExtensionnagedra/silent-check-sso.html"
      });

      if (authenticated) {
        // Notify iframe / opener
        window.opener?.postMessage(
          { type: "KC_LOGIN_SUCCESS" },
          "*"
        );
        console.log("KC_LOGIN_SUCCESS message sent");
      }

      // Close redirect tab safely
     

    } catch (err) {
      console.error("Keycloak init failed", err);
    }
  })();
</script>
