 <script src="https://cdn.jsdelivr.net/npm/keycloak-js@25.0.6/dist/keycloak.min.js"></script>
<script>
  const bc = new BroadcastChannel("kc-auth");

  const keycloak = new Keycloak({
    url: "https://securedev.virtuele.us",
    realm: "virtuele-dev",
    clientId: "web"
  });
 
new BroadcastChannel("kc-message").postMessage("HELLO_IFRAME");
  // OPTIONAL: expose globally
  window.keycloak = keycloak;

  (async () => {
    const authenticated = await keycloak.init({
      onLoad: "check-sso",
      pkceMethod: "S256",
      silentCheckSsoRedirectUri:
        location.origin + "/trimbleExtensionnagedra/silent-check-sso.html"
    });

     if (authenticated) {
      bc.postMessage({ type: "LOGIN_SUCCESS" });

      // ðŸš¨ REQUIRED delay
      setTimeout(() => {
        bc.close();
        window.close();
      }, 300);
    }
  })();
</script>
